!function(window,document){"use strict";window.App=Ember.Application.create(),App.NAME="Hot Catz",App.IndexRoute=Ember.Route.extend({model:function(){return this.store.find("cat")},afterModel:function(){App.randomCatz()}}),App.randomCatz=function(){var i,recordLength=App.Cat.store.all("cat").get("length"),twoCatsPlease=[];for(i=0;2>i;i+=1)twoCatsPlease.pushObject(App.Cat.store.all("cat").objectAt(Math.floor(Math.random()*recordLength)));App.voteCat(twoCatsPlease)},App.voteCat=function(twoCatArr){App.firstCat=twoCatArr[0],App.secondCat=twoCatArr[1]},App.Router.map(function(){this.resource("cats",function(){this.resource("cat",{path:":cat_id"})})}),App.CatsRoute=Ember.Route.extend({model:function(){return this.store.find("cat")}}),App.IndexView=Ember.View.extend({didInsertElement:function(){var contestants=this.$(".contestants").find("li");Array.prototype.forEach.call(contestants,function(item,i){var rank;rank=0===i?"top-competitors one":1===i?"top-competitors two":2===i?"top-competitors three":"",item.className=rank})}}),App.IndexController=Ember.ArrayController.extend({sortProperties:["vote"],sortAscending:!1,actions:{mainVote:function(name,vote){Ember.$.ajax({type:"PUT",url:"/cats",dataType:"jsonp",data:{name:name,vote:vote+=1},context:this}).done(function(){console.log("Your vote has been logged"),this.store.find("cat")}).fail(function(){console.log("Voting failed"),this.store.find("cat")}).complete(function(){window.location.reload()})},addVote:function(name,vote){var updateTopCats=function(){var contestants=this.$(".contestants").find("li");Array.prototype.forEach.call(contestants,function(item,i){var rank="test";console.log(i),rank=0===i?"top-competitors one":1===i?"top-competitors two":2===i?"top-competitors three":"",item.className=rank})};Ember.$.ajax({type:"PUT",url:"/cats",dataType:"jsonp",data:{name:name,vote:vote+=1},context:this}).done(function(){return console.log("Your vote has been logged"),this.store.find("cat")}).fail(function(){return console.log("Voting failed"),this.store.find("cat")}).complete(function(){$(".contestants").find("li").removeClass("top-competitors"),setTimeout(updateTopCats,1e3)})}}}),App.CatsController=Ember.ArrayController.extend({sortProperties:["vote"],sortAscending:!1}),App.Store=DS.Store.extend({revision:12,addapter:DS.RESTAdapter.create()}),App.ApplicationSerializer=DS.RESTSerializer.extend({primaryKey:"_id",normalizePayload:function(type,payload){return{cats:payload}}}),App.Cat=DS.Model.extend({name:DS.attr("string"),picture:DS.attr("string"),vote:DS.attr("number")}),$(function(){App.submitNewCat=function(file){{var urlThumb=window.location.origin+"/uploads/",imageFilename=file,imageFilenameArr=imageFilename.split("\\");imageFilenameArr.length}$(".upload-form").ajaxSubmit(function(){var imageFilename=$(".file-upload").val(),imageFilenameArr=imageFilename.split("\\"),size=imageFilenameArr.length,preview=$(".preview");urlThumb+=imageFilenameArr[size-1],preview.find("img").attr("src",""),preview.css("height","auto"),App.getNewCatThumb(urlThumb),App.Cat.store.find("cat")})},App.getNewCatThumb=function(url){$.ajax({type:"GET",url:url}).done(function(){var preview=$(".preview");preview.append('<img class="preview-thumb" src="'+url+'" alt="">'),preview.find(".instructions").text("Look at that cute cat!")}).fail(function(){console.log("Thumb error")})},$(document).on("change",".file-upload",function(){$(".preview").find(".instructions").text($(this).val())}),$(document).on("submit",".upload-form",function(e){var file=$(".file-upload").val(),catName=$(".cat-name-upload"),catNameValue=$(".cat-name-upload").val(),preview=$(".preview"),removeError=function(element){element.removeClass("upload-error")},addError=function(element){element.addClass("upload-error")},isAlphaNumeric=function(value){var pattern=/^[A-Za-z0-9' ']+$/;return pattern.test(value)};if(e.preventDefault(),isAlphaNumeric(catNameValue)&&file.length>1)preview.css("background","#e8e9e5"),App.submitNewCat(file,catNameValue);else{if(isAlphaNumeric(catNameValue))return preview.find(".instructions").text("Please upload a photo of your cat."),preview.css("background","#f4cbcb"),removeError(catName),void 0;addError(catName),catName.attr("placeholder","Please enter a valid cat name.")}}),$(document).on("click",".preview",function(e){e.preventDefault(),$(".file-upload").trigger("click")})})}(window,document);